{% extends "base_generic.html" %}

{% block title %}
  <title>Records for {{ this_location.name }} - Gamechanger Action Tracker</title>
{% endblock %}

{% block content %}
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

  <div style="width: 100%; float:right;">
    <h1 style="float: left; margin: auto;">Records for {{ this_location.name }}</h1>
    {% if user.is_authenticated %}
    <form style="float: left; margin-left: 0.5em; margin-right: 0.5em;" action="" method="post">
      {% csrf_token %}
      <div class="favoriteform" style="white-space:nowrap; display:inline-block;">
        {% if favorite_location == 'True' %}
          <input type="submit" name="favorite" id="favorite" value="Remove from Favorites" style="color:red; display: inline-block;"/>
        {% else %}
          <input type="submit" name="favorite" id="favorite" value="Add to Favorites" style="color:green; display: inline-block;"/>
        {% endif %}
      </div>
    </form>
    {% endif %}
    <div style="float: left; margin-bottom: 1.5em;">
      <p style="margin-top:0.35em;">
        {% if parent_location %}
          {% if parent_location.id > 0 %}
            &nbsp;&nbsp;in <a href="{% url 'action:geo_view' parent_location.id %}">{{ parent_location.name }}</a>
          {% else %}
            <a>Unknown</a>
          {% endif %}
        {% else %}
        <p style="margin-left: -25.95em; margin-top: -0.5em;">.</p>
        {% endif %}
      </p>
    </div>
  </div>

  {% if sublocation_list %}
    <h2>{{ sublocation_list|length }} locations within {{ this_location.name }}</h2>

      <ul style="float: left; margin-bottom: 2em; width: 100%;">
        {% for sublocation in sublocation_list %}
        <li style="float: left; margin-left: 1.5em; margin-bottom: 0.5em;">
          <a href="{% url 'action:geo_view' sublocation.id %}">{{ sublocation }}</a>
        </li>
        {% endfor %}
      </ul>
      
    <h2>Direct Records for {{ this_location.name }} in addition to the locations above</h2>
  {% endif %}

  <h2>Records</h2>
  {% if witness_list %}
    <p>{{ witness_list|length }} events with a total of {{ total_participants }} 
    recorded participants</p>
  {% else %}
    <p>No results registered yet.</p>
  {% endif %}
  
  <!--
  {% if witness_list %}
    <form action="{% url 'action:geo_update' %}" method="POST">
      {% csrf_token %}
      <input type="hidden" value="False" name="isnewevent"/>
      <input type="hidden" value="{{root_gathering.regid}}" name="regid"/>
      <input type="hidden" value="{{this_location.id}}" name="locid"/>
      <!--<input type="submit" value="Register new Event">--!>
      <input type="submit" value="Record Event"/>
    </form>
    <br/>
  {% endif %}
  -->
  {% if event_list %}
    <!--
    <table id="upcomming">

    </table>
    -->
    <table id="past">
      <thead>
        <tr>
          <th>Date</th>
          <th>Map</th>
          <th>Participants</th>
          <th>Overview</th>
          <th>Type</th>
          <th>Recording Media Link</th>
          <th>Host</th>
        </tr>
      </thead>
      <tbody>
        {% for event in event_list %}
        <tr>
          <td class="td_date">
            {% if event.2 %}
            <form action="{% url 'action:geo_update' %}" method="POST">
              {% csrf_token %}
                <input type="hidden" value="False" name="isnewevent"/>
                <input type="hidden" value="{{event.1.gathering.regid}}" name="regid"/>
                <input type="hidden" value="{{this_location.id}}" name="locid"/>
                <input type="hidden" value="{{event.1.id}}" name="witness"/>
              <input type="submit" value="{{event.0|date:'Y-m-d' }}" style="background-color:{% if event.3 %}#1DA64A{% else %}#A5A51D{% endif %} !important;"/>
            </form>
            {%else%}
              <input type="submit" value="{{event.0|date:'Y-m-d'}}" style="background-color:{% if event.3 %}#1DA64A{% else %}#A5A51D{% endif %} !important; cursor: not-allowed;"/>
            {%endif%}
          </td>
          <td id="th_map">
            {% if event.2 %}
              <a target="_blank" href="https://map.fridaysforfuture.org/?e={{event.1.gathering.regid}}"><img src="/static/icon_globe.png"/><sup><sup><img style="width: 16px;" src="/static/icon-external.png"/></sup></sup></a>
            {% else %}
            <a target="_blank" href="https://map.fridaysforfuture.org/?e={{event.1.regid}}"><img src="/static/icon_globe.png"/><sup><sup><img style="width: 16px;" src="/static/icon-external.png"/></sup></sup></a>
            {% endif %}
          </td>
          <td class="td_participants">
            {% if event.2 %}
              {% if event.1.participants %}
                {{event.1.participants}}
              {% endif %}
            {% else %}
              {% if event.1.expected_participants %}
                {{event.1.expected_participants}}
              {% endif %}
            {% endif %}
          </td>
          <td class="td_overview">
            {% if event.2 %}
               <a href="{% url 'action:gathering_view' event.1.gathering.regid %}">Record <!--{{event.1.gathering.regid}}--></a>
            {% else %}
               <a href="{% url 'action:gathering_view' event.1.regid %}">Event <!--{{event.1.regid}}--></a>
            {% endif %}
          </td>
          <td class="td_type">
            {% if event.2 %}
              {% for gathering_type in gathering_types %}
                {% if gathering_type.0 == event.1.gathering.gathering_type %}
                  {{gathering_type.1}}
                {%endif%}
              {%endfor%}
            {% else %}
              {% for gathering_type in gathering_types %}
                {% if gathering_type.0 == event.1.gathering_type %}
                  {{gathering_type.1}}
                {%endif%}
              {%endfor%}
            {% endif %}
          </td>
          <td class="td_link">
            {% if event.2 %}
              {% if event.1.proof_url %}
                <a target="_blank" href="{{ witness.proof_url }}">
                  {% if "facebook.com" in event.1.proof_url or "scontent" in event.1.proof_url %}
                    <img src="/static/icon_fb30.png"/>
                  {% elif "instagram.com" in event.1.proof_url %}
                    <img src="/static/icon_insta30.png"/>
                  {% elif "twitter.com" in event.1.proof_url %}
                    <img src="/static/icon_twitter30.png"/>
                  {% elif "youtube.com" in event.1.proof_url %}
                    <img src="/static/icon_yt30.png"/>
                  {% else %}
                    <img src="/static/icon_pic.png"/>
                  {% endif %}
                  <sup><sup><img style="width: 16px;" src="/static/icon-external.png"/></sup></sup></a>
              {% endif %}
            {% else %}
              <!---->
            {% endif %}
          </td>
          <td class="td_host">
            {% if event.2 %}
              {% if event.1.organization %}
                <span hidden="true">{{ event.1.organization }}</span>
                  <small>{{ event.1.organization }}</small>
              {% else %}
                <span hidden=true>z-sort</span>
              {% endif %}
            {% else %}
              {% if event.1.organizations.0 %}
                <span hidden="true">{{ event.1.organizations.0 }}</span>
                    <small>{{ event.1.organizations.0 }}</small>
              {% else %}
                <span hidden=true>z-sort</span>
              {% endif %}
            {% endif %}
          </td>
          <!--
          <td class="td_">
            {% if event.2 %}
              {{event.1}}
            {% else %}
              {{event.1}}
            {% endif %}
          </td>
          -->
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% endblock %}

{% block adminpanel %}
    <form action="{% url 'action:af_mark_as_duplicate' %}" method="post">
      {% csrf_token %}
      <input type="hidden" name="duplicate" value="{{this_location.id}}" />
      <label>Duplicate Prime location</label>
      <input type="number" name="prime" />
      <br />
      <input type="submit" value="Submit Duplicate" />
    </form>
{% endblock %}