{% extends "base_generic.html" %}

{% block content %}

<style>
  div.favoriteform > input {display: inline-block;}
</style>

{% if date %}
  <form action="{% url 'action:report_date' regid date %}" method="post">
{% else %}
  <form action="{% url 'action:report_results' regid %}" method="post">
{% endif %}
  {% csrf_token %}
  <div class="favoriteform" style="white-space:nowrap; display:inline-block;">
    <p>Report Results for{% if favorite_location == 'True' %} favorite location{% endif %}</p>
    <h1 style="display: inline-block;">{{ place_name }}</h1>
    {% if favorite_location == 'True' %}
      <input type="submit" name="favorite" id="favorite" value="Remove from Favorites" style="color:red; display: inline-block;"/>
    {% endif %}
    {% if favorite_location == 'False' %}
      <input type="submit" name="favorite" id="favorite" value="Add to Favorites" style="color:green; display: inline-block;"/>
    {% endif %}
  </div>
</form>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<form action="{% url 'action:report_results' regid %}" method="post">
  {% csrf_token %}
  <input type="date" name="date" value="{{ date|default:today }}" onchange="this.form.submit()"/>
</form>
{% if date %}
  <form action="{% url 'action:report_date' regid date %}" method="post" id="form">
    {% csrf_token %}
    <input type="hidden" id="prev_participants" value="{{ prev_participants }}"/>
    <input type="hidden" id="prev_url" value="{{ prev_url }}"/>
    <script type="text/javascript">
      // For XHTML: <![CDATA[
      function show_unsaved(show) {
        if(show) {
          document.getElementById("save_changes").style.display = "inline-block";
          document.getElementById("form").style.backgroundColor = "#ffeeee";
          document.getElementById("favorite").style.display = "none";
        } else {
          document.getElementById("save_changes").style.display = "none";
          document.getElementById("form").style.backgroundColor = "";
          document.getElementById("favorite").style.display = "inline-block";
        }
      }
      function check_unsaved() {
        if(document.getElementById("prev_participants").value == document.getElementById("participants").value &&
           document.getElementById("prev_url").value == document.getElementById("url").value) {
          show_unsaved(false);
        } else {
          show_unsaved(true);
        }
      }
      // For XHTML: ]]>
    </script>
    <table>
      <tr>
        <td><legend>Participants</legend></td>
        <td><input type="number" id="participants" name="participants" value="{{ prev_participants }}" min="1" max="99999" oninput="check_unsaved()" onchange="check_unsaved()"/></td>
      </tr>
      <tr>
        <td/>
        <td><p>You are welcome to share a photo from the event (optional) that we can show the world.</p></td>
      </tr>
      <tr>
        <td><legend>URL to Photo</legend></td>
        <td><input type="url" id="url" name="url" value="{{ prev_url }}" size="60" oninput="check_unsaved()" onchange="check_unsaved()"/></td>
      </tr>
      <tr>
        <td style="white-space:nowrap;">
          <input type="submit" value="Report Result" style="display: inline-block;"/>
        </td>
        <td style="white-space:nowrap;">
          <div style="color:red; display: none;" id="save_changes">&nbsp;&nbsp;&nbsp;â†¤&nbsp;&nbsp;Save Your Changes</div>
        </td>
      </tr>
    </table>
  </form>
{% endif %}
<h2>Reports</h2>
{% if gathering_list %}
  <ul>
  {% for witness in gathering_list %}
    <li><a href="/action/report_results/date/{{ regid }}/{{ witness.date|date:'Y-m-d' }}/">{{ witness.date|date:"Y-m-d" }}</a>
      : {{ witness.participants }}
      {% if witness.proof_url %}  <a href="{{ witness.proof_url }}">View Photo</a>{% endif %}
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p>No results registered yet.</p>
{% endif %}
{% endblock %}